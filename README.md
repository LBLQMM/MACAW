# Macaw

Macaw (**m**olecular **a**utoen**c**oding **a**uto-**w**orkaround) is a cheminformatic tool that embeds molecules onto a low-dimensional, continuous numeric space. The embeddings are molecular features that can be used as inputs in mathematical and machine-learning models.

Macaw embeddings can be used as a drop-in replacement for conventional molecular descriptors. Macaw embeddings are fast and easy to compute, variable selection is not needed, and they may enable more accuracte predictive models than conventional molecular descriptors.

The Macaw package also contains original algorithms to generate molecular libraries and to evolve molecular libraries *in silico* that approximate a desired property specification (inverse design problem).

Details about the different algorithms are explained in the [Macaw publication]().


## Installation

Macaw requires rdkit to run, which can be installed using [conda](https://anaconda.org/conda-forge/rdkit):

```bash
conda install -c conda-forge rdkit
```

Alternative methods to install rdkit can be found [here](https://www.rdkit.org/docs/Install.html).


Then run the following command to install Macaw:

```bash
pip install macaw_py
```

## Usage

The following illustrates some of the main commands in Macaw. Detailed use examples with real datasets are available as Jupyter Notebooks in the [Macaw repository](https://github.com/LBLQMM/macaw).


### Molecule embedding

Given a list of molecules represented as SMILES strings (`smiles`), their Macaw embedding (`X`) can be obtained as follows:

```python
from macaw_py import *

mcw = Macaw()
mcw.fit(smiles)
X = mcw.transform(smiles)
```

Any list of molecules in SMILES format (`newsmiles`) can be embedded using an existing Macaw object:

```python
X_new = mcw.transform(newsmiles)
```

The embedder has a variety of parameters that can be tuned to improve results. These include the dimensionality of the embedding (`n_components`), the number of landmarks used (`n_landmarks`), the type of molecular fingeprint (`type_fp`), and the similarity metric (`metric`). Property values (`y_values`) can also be provided to the argument `Y` to improve landmark choice. The arguments and options available are listed in the class help.

```python
mcw = Macaw(smiles, n_components=20, type_fp='rdk5', metric='Dice')

mcw.fit_transform(smiles, n_landmarks=60, Y=y_values)
```

The function `Macaw_optimus` automatically explores a variety of fingeprint type (`type_fp`) and similarity metric (`metric`) combinations and returns a recommended embedder:

```python
mcw = Macaw_optimus(smiles, n_components=20, y=y_values, verbose=True)
```

### Molecule generation

Given an input dataset of molecules in SELFIES format, Macaw's `library_maker` function will generate a library of molecules around it. The maximum number of molecules to generate is specified with the `n_gen` parameter, while the spread of the distribution can be controlled with the `noise_sd_factor` argument. Additional parameters are explained in the function help.


```python
smiles_lib = library_maker(smiles, n_gen=50000, noise_sd_factor=0.3)
```

### Molecule recommendation (inverse design)

Given a property of interest, a model `f` can be trained to predict the property values of different molecules. The model `f` takes as inputs the features generated by the embedder `mcw`.

Then, we can evolve and recommend molecules to satisfy a desired property specification value (`spec`) using the function `library_evolver`. It takes as input an initial set of molecules (`smiles`), the featurizer (`mcw`), the predictive model (`f`), the desired specification value (`spec`), the number of molecules ro recommend (`n_hits`), the number of evolution rounds (`n_rounds`). Other optional arguments described in the function help.

```python
recommended_smiles = library_evolver(smiles, mcw, f, spec, n_hits=10, n_rounds=8)
```

## License
[MIT](https://choosealicense.com/licenses/mit/)